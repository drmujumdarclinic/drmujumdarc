<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book Appointment ‚Äì Dr. Mujumdar Clinic</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f8ff; margin: 0; padding: 0; }
    .ticker {
      background: #e1f5fe;
      color: #01579b;
      padding: 10px;
      font-weight: bold;
      overflow: hidden;
      white-space: nowrap;
    }
    .ticker span {
      display: inline-block;
      animation: scroll 16s linear infinite;
    }
    @keyframes scroll {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    .container {
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: relative;
    }

    h2 { text-align: center; color: #1565c0; }
    label { margin-top: 10px; display: block; font-weight: bold; }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      width: 100%;
      padding: 12px;
      background: #1565c0;
      color: white;
      border: none;
      margin-top: 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
    }
    .footer {
      text-align: center;
      margin-top: 20px;
    }
    .footer a {
      text-decoration: none;
      color: #1565c0;
    }
    .status {
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
      color: red;
    }

   
    }
  </style>
</head>
<body>
<div id="custom-loader-placeholder"></div>

  <!-- Moving Ticker -->
  <div class="ticker">
    <span>üîî Welcome to Dr. Mujumdar Clinic | ‡§°‡•â. ‡§Æ‡•Å‡§ú‡•Å‡§Æ‡§¶‡§æ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§®‡§ø‡§ï‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ü‡§™‡§≤‡•á ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á | Contact: 9422229636 | Some slots may fill early.</span>
  </div>

  <!-- Loader Overlay -->
  <div class="overlay" id="overlay">
    <div class="loader"></div>
  </div>

  <!-- Main Form -->
  <div class="container">
    <h2>Book Your Appointment <br>‡§Ö‡§™‡•â‡§á‡§Ç‡§ü‡§Æ‡•á‡§Ç‡§ü ‡§¨‡•Å‡§ï ‡§ï‡§∞‡§æ</h2>
    <form id="bookingForm">
      <label>Full Name / ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§æ‡§µ:</label>
      <input type="text" name="name" required />

      <label>Email:</label>
      <input type="email" name="email" required />

      <label>Phone / ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞:</label>
      <input type="tel" name="phone" required />

      <label>Date / ‡§§‡§æ‡§∞‡•Ä‡§ñ:</label>
      <input type="date" name="date" id="date" required />

      <label>Time Slot / ‡§µ‡•á‡§≥:</label>
      <select name="time" id="time" required>
        <option value="">Please select a date first / ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ü‡§ß‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§®‡§ø‡§µ‡§°‡§æ</option>
      </select>

      <button type="submit">Submit / ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§æ</button>
      <div class="status" id="status"></div>
    </form>

    <div class="footer">
      <a href="index.html">‚Üê Back to Home / ‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§™‡•É‡§∑‡•ç‡§†‡§æ‡§µ‡§∞ ‡§ú‡§æ</a>
    </div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycby2hOwVTirST53CPrauMe7N5xrn6yIcuexlS8f8jW_Y33ZseEkq4wQAal4yRziZJMoI/exec";
    const form = document.getElementById("bookingForm");
    const dateInput = document.getElementById("date");
    const timeSelect = document.getElementById("time");
    const statusEl = document.getElementById("status");
    const overlay = document.getElementById("overlay");

    // Disable past dates
    dateInput.min = new Date().toISOString().split("T")[0];

    // Generate 10-minute time slots
    function generateTimeSlots(start, end) {
      const slots = [];
      const startTime = new Date(`1970-01-01T${start}:00`);
      const endTime = new Date(`1970-01-01T${end}:00`);
      while (startTime < endTime) {
        const from = startTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        startTime.setMinutes(startTime.getMinutes() + 10);
        const to = startTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        slots.push(`${from} - ${to}`);
      }
      return slots;
    }

    dateInput.addEventListener("change", () => {
      const selectedDate = dateInput.value;
      const day = new Date(selectedDate).getDay();
      let allSlots = (day === 0)
        ? generateTimeSlots("11:00", "17:00")  // Sunday
        : [...generateTimeSlots("11:00", "16:00"), ...generateTimeSlots("18:00", "23:00")];

      // Fetch booked slots
      fetch(scriptURL)
        .then(res => res.json())
        .then(booked => {
          const available = allSlots.filter(slot => !booked.includes(`${selectedDate}|${slot}`));
          timeSelect.innerHTML = "";

          if (available.length === 0) {
            timeSelect.innerHTML = '<option disabled>No slots available / ‡§µ‡•á‡§≥ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä</option>';
          } else {
            available.forEach(slot => {
              const opt = document.createElement("option");
              opt.value = slot;
              opt.textContent = slot;
              timeSelect.appendChild(opt);
            });
          }
        })
        .catch(() => {
          timeSelect.innerHTML = '<option disabled>Error loading slots</option>';
        });
    });

    form.addEventListener("submit", e => {
      e.preventDefault();
      overlay.style.display = "flex"; // Show loader
      statusEl.textContent = "";

      fetch(scriptURL, {
        method: "POST",
        body: new FormData(form)
      })
      .then(res => res.text())
      .then(response => {
        overlay.style.display = "none";
        if (response === "SUCCESS") {
          const name = form.name.value;
          const date = form.date.value;
          const time = form.time.value;
          window.location.href = `success.html?name=${encodeURIComponent(name)}&date=${encodeURIComponent(date)}&time=${encodeURIComponent(time)}`;
        } else if (response === "ALREADY_BOOKED") {
          statusEl.textContent = "‚ùå This slot is already booked. Please choose another. / ‡§µ‡•á‡§≥ ‡§Ü‡§ß‡•Ä‡§ö ‡§Ü‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§Ü‡§π‡•á.";
        } else {
          statusEl.textContent = "‚ö†Ô∏è Something went wrong. Please try again.";
        }
      })
      .catch(() => {
        overlay.style.display = "none";
        statusEl.textContent = "‚ö†Ô∏è Network error. Please try again.";
      });
    });

    dateInput.addEventListener("change", () => {
  const selectedDate = dateInput.value;
  const today = new Date().toISOString().split("T")[0];
  const now = new Date();
  const selectedDay = new Date(selectedDate).getDay();

  let allSlots = selectedDay === 0
    ? generateTimeSlots("11:00", "17:00")  // Sunday
    : [...generateTimeSlots("11:00", "16:00"), ...generateTimeSlots("18:00", "23:00")];  // Mon‚ÄìSat

  // Filter out past time slots if today is selected
  if (selectedDate === today) {
    const currentTime = now.getHours() * 60 + now.getMinutes(); // current time in minutes
    allSlots = allSlots.filter(slot => {
      const slotStart = slot.split(" - ")[0];
      const [hours, minutes, period] = slotStart.match(/(\d+):(\d+)\s*(AM|PM)/i).slice(1);
      let hrs = parseInt(hours);
      if (period.toUpperCase() === "PM" && hrs !== 12) hrs += 12;
      if (period.toUpperCase() === "AM" && hrs === 12) hrs = 0;
      const totalMins = hrs * 60 + parseInt(minutes);
      return totalMins > currentTime;
    });
  }

  fetch(scriptURL)
    .then(res => res.json())
    .then(booked => {
      timeSelect.innerHTML = "";
      const available = allSlots.filter(slot => !booked.includes(`${selectedDate}|${slot}`));
      if (available.length === 0) {
        timeSelect.innerHTML = '<option disabled>No slots available / ‡§µ‡•á‡§≥ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä</option>';
      } else {
        available.forEach(slot => {
          const opt = document.createElement("option");
          opt.value = slot;
          opt.textContent = slot;
          timeSelect.appendChild(opt);
        });
      }
    });
});

  </script>
<script>
  // Load loader.html and inject it into the page
  fetch("loader.html")
    .then(response => response.text())
    .then(html => {
      document.getElementById("custom-loader-placeholder").innerHTML = html;
    });

  // Hide loader on page load
  window.addEventListener("load", () => {
    setTimeout(() => {
      const loader = document.getElementById("custom-loader");
      if (loader) loader.style.display = "none";
    }, 1000); // 1 second delay for better UX
  });
</script>

</body>
</html>
